# 3D mapping

{/* เว้นบรรทัดว่าง 1 บรรทัด เพื่อแยก Header ออกจากปุ่ม */}

{/* ปุ่มที่ 1: สำหรับไฟล์ Mapping */}
<div style={{ marginBottom: '5px', marginTop: '20px' }}>
  <a href="/configs/limx_mapping_rviz.rviz" download="limx_mapping_rviz.rviz" style={{
    display: 'inline-flex',    /* จัดเรียงแนวนอน */
    alignItems: 'center',      /* จัดกึ่งกลางแนวตั้ง */
    gap: '12px',               /* ระยะห่าง */
    backgroundColor: '#3f3f41',
    border: '2px solid #444',
    color: '#fff',
    padding: '12px 20px',      /* แก้ความสูงปุ่มให้สวยงาม (จากเดิม 0px) */
    borderRadius: '8px',
    textDecoration: 'none',
    fontSize: '14px',
    fontFamily: 'sans-serif'
  }}>
    {/* ไอคอน */}
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
      <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
      <polyline points="7 10 12 15 17 10"></polyline>
      <line x1="12" y1="15" x2="12" y2="3"></line>
    </svg>

    {/* ข้อความ (แยกส่วนตัวหนา) */}
    <span>
      ดาวน์โหลด <strong style={{ fontWeight: 'bold' }}>limx_mapping_rviz</strong>
    </span>
  </a>

  <div style={{ fontSize: '14px', color: '#888', marginTop: '8px' }}>
    ใช้สำหรับทำแผนที่ (Mapping Mode)
  </div>
</div>


{/* เปลี่ยน <p> เป็น <div> เพื่อแก้ Error Hydration failed */}
<div style={{ fontSize: '14px', color: '#888', marginTop: '5px', marginBottom: '30px' }}>
  วิธีใช้: ดาวน์โหลดไฟล์นี้แล้วเปิดใน RViz ผ่านเมนู File &gt; Open Config
</div>

{/* เว้นบรรทัดว่าง 1 บรรทัด ตรงนี้สำคัญมาก ห้ามลบ! */}

### 1. เปิด 2 Terminals บนคอมพิวเตอร์ของคุณ

โดยใช้คำสั่ง ssh guest@10.192.1.3  <span style={{ marginRight: '20px' }}></span> # Password : 123456
> หมายเหตุ : .ใช้บอร์ดพัฒนาที่อยู่กับตัวไลดาร์

1.1 Terminal 1: รัน Driver LiDAR
```bash filename="bash" 
ssh guest@10.192.1.3 # password : 123456
cd ~/catkin_ws
source devel_isolated/setup.bash
roslaunch livox_ros_driver2 msg_MID360.launch
```

1.2 Terminal 2: รันโปรแกรมสร้างแผนที่
```bash filename="bash" 
ssh guest@10.192.1.3 # password : 123456
cd ~/catkin_ws
source devel_isolated/setup.bash
roslaunch fast_lio_sam_sc_qn run.launch lidar:=livox_mid360
```

1.3 คอมพิวเตอร์ผู้ใช้ (Local Computer) ตั้งค่า IP เพื่อดูภาพบนโปรแกรม RViz (แก้ 10.192.1.X เป็น IP ของคุณ)
```bash filename="bash" 
source /opt/ros/noetic/setup.bash
export ROS_IP=10.192.1.X
export ROS_MASTER_URI=http://10.192.1.3:11311
rviz
```
>หมายเหตุ : หลังจากรันโปรแกรม RViz ให้ Open Config File ชื่อ "limx_mapping_rviz.rviz"

### 2. การบันทึกแผนที่ (MapSave)
    2.1	เมื่อเดินสำรวจครบแล้วกลับไปที่ Terminal 2 แล้วกด Ctrl + C เพื่อทำหยุดการบันทึกแผนที่
    
    
    >  ไฟล์ result.pcd จะถูกบันทึกอัตโนมัติที่ 
    > " /home/guest/catkin_ws/src/fast-lio-mapping_and_localization-sc-qn/fast_lio_sam_sc_qn/ "

### 3. การแปลงแผนที่และการนำไปใช้ (Post-Processing)
    3.1 แปลง 3D PCD เป็น 2D Grid Map แก้ไขไฟล์ aa.launch เพื่อชี้ไปยังไฟล์ pcd ที่เพิ่งได้มา

    > แก้ไขไฟล์เข้าไปที่

    ```bash filename="bash"
    cd /home/guest/catkin_ws/src/fast-lio-mapping_and_localization-sc-qn/fast_lio_sam_sc_qn
    vim ~/catkin_ws/src/fast-lio-mapping_and_localization-sc-qn/fast_lio_localization_sc_qn/launch/aa.launch
    ```
    > แก้บรรทัด pcd_filename ให้เป็น path ของไฟล์ result.pcd

    > จากนั้นรันคำสั่งแปลงไฟล์

    ```bash filename="bash"
    source devel_isolated/setup.bash
    roslaunch fast_lio_localization_sc_qn aa.launch
    ```

    > ทำการเปิด Terminal  หน้าใหม่ขึ้นมาเพื่อบันทึกที่อยู่ของไฟล์ .pgm และ .yaml

    ```bash filename="bash"
    source /opt/ros/noetic/setup.bash
    cd ~/
    rosrun map_server map_saver -f limx_map 
    ```
    > หมายเหตุ : limx_map เป็นเพียงชื่อตัวอย่างไฟล์คุณสามารถเปลี่ยนเป็นชื่อไฟล์ของคุณได้
    <div style={{ fontSize: '16px', color: '#eae6e6', marginTop: '5px', marginBottom: '30px' }}>
    <span style={{ marginRight: '150px' }}></span> จะได้ไฟล์ limx_map.pgm และ limx_map.yaml
    </div>

    ### 4. Map timming
      สำหรับระบบ Linux จำเป็นต้องดาวน์โหลดซอฟต์แวร์แก้ไขภาพ gmp ล่วงหน้า และขั้นตอนการติดตั้งในเครื่องมีดังนี้
    > หมายเหตุ : หากมีซอฟต์แวร์นี้อยู๋แล้วให้ข้ามขั้นตอนนี้ไปได้เลย

    คำสั่งเพื่อดาวน์โหลดซอฟต์แวร์ผ่าน Terminal บนคอมพิวเตอร์ของคุณ

    ```bash filename="bash"
    sudo apt install -y gimp language-pack-gnome-zh-hant language-pack-gnome-zh-hans
    ```
    4.1 ถ่ายโอนไฟล์ limx.pgm ที่สร้างขึ้นจากบอร์ดพัฒนาไปยังคอมพิวเตอร์ของผู้ใช้ 
    > เปิด Terminal (โดยไม่ต้อง SSH ) หลังจากนั้นใช้คำสั่งด้านล่างนี้

    ```bash filename="bash"
    scp guest@10.192.1.3:/home/guest/limx_map.pgm ~/ 
    #guest is the username of the development board
    # 10.192.1.3 is the IP address of the development board.  
    #/home/guest/limx_map.pgm is the save path of the PGM map in the development board
    # ~/ is the save path of the PGM map on the user's computer.    
    ```

    > จากนั้นเข้า SSH ไปยัง guest@10.192.1.3 เพื่อถ่ายโอนข้อมูลให้ตัว TRON1
    ```bash filename="bash"
    ssh guest@10.192.1.3    #//password：123456
    scp -r limx_map.pgm guest@10.192.1.2:~/ 
    ```

    > หลังจากทำการแก้ไขไฟล์ .gmp บนคอมพิวเตอร์ของคุณเสร็จแล้วทำการถ่ายโอนข้อมูลกลับไปยัง guest@10.192.1.3
    ```bash filename="bash"
    scp -r limx_map.pgm guest@10.192.1.3:~/  #This command is executed on the local terminal of the user's computer
    ```
    การแปลง 3D PCD เป็น 2D Grid Map เสร็จสิ้น

